```{r}
#Question: look at vs additions

##install if needed
if(!require("dplyr")) install.packages("dplyr")
if(!require("janitor")) install.packages("janitor")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("tidyr")) install.packages("tidyr")
if(!require("readr")) install.packages("readr")

##bring in libraries
library(dplyr)
library(janitor)
library(ggplot2)
library(tidyr)
library(readr)

##pull and shrink data
coffee_df <- read_csv("C:/Users/grego/Downloads/coffee_survey.csv")

clean_coffee_df <- coffee_df[!apply(coffee_df[, -1], 1, function(x) all(is.na(x))), ] #remove data if everything is NA

clean_coffee_df <- mutate(clean_coffee_df, age = case_when(age == "<18 years old" ~ "0-17 years old", TRUE ~ age)) # Make <18 years old properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, age = case_when(age == ">65 years old" ~ "65+ years old", TRUE ~ age)) # Make >65 years old properly alphabetized

clean_coffee_df <- mutate(clean_coffee_df, caffeine = case_when(caffeine == "Full caffeine" ~ "1", TRUE ~ caffeine)) # Make Full caffeine properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, caffeine = case_when(caffeine == "Half caff" ~ "0.5", TRUE ~ caffeine)) # Make Half caff properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, caffeine = case_when(caffeine == "Decaf" ~ "0", TRUE ~ caffeine)) # Make Decaf properly alphabetized

clean_coffee_df <- mutate(clean_coffee_df, strength = case_when(strength == "Weak" ~ "1", TRUE ~ strength)) # Make Weak properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, strength = case_when(strength == "Somewhat light" ~ "2", TRUE ~ strength)) # Make Somewhat light properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, strength = case_when(strength == "Medium" ~ "3", TRUE ~ strength)) # Make Medium properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, strength = case_when(strength == "Somewhat strong" ~ "4", TRUE ~ strength)) # Make Somewhat strong properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, strength = case_when(strength == "Very strong" ~ "5", TRUE ~ strength)) # Make Very strong properly alphabetized

clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "Blonde" ~ "1", TRUE ~ roast_level)) # Make Blonde properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "Nordic" ~ "1.5", TRUE ~ roast_level)) # Make Nordic properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "Light" ~ "2", TRUE ~ roast_level)) # Make Light properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "Medium" ~ "2.5", TRUE ~ roast_level)) # Make Medium properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "Dark" ~ "3", TRUE ~ roast_level)) # Make Dark properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "French" ~ "3.5", TRUE ~ roast_level)) # Make French properly alphabetized
clean_coffee_df <- mutate(clean_coffee_df, roast_level = case_when(roast_level == "Italian" ~ "4", TRUE ~ roast_level)) # Make Italian properly alphabetized



##exploring data
new_coffee_df <- filter(clean_coffee_df, !is.na(age), !is.na(strength), !is.na(roast_level), !is.na(caffeine))

#new_coffee_df <- slice_sample(new_coffee_df, n = 41 )# I chose 41 because that is the max rows visible on my screen

new_coffee_df <- select(new_coffee_df, age, strength, roast_level, caffeine, everything())
new_coffee_df <- arrange(new_coffee_df, age, strength, roast_level, caffeine)

new_coffee_df <- new_coffee_df[!is.na(new_coffee_df$strength), ]
new_coffee_df <- new_coffee_df[!is.na(new_coffee_df$roast_level), ]
new_coffee_df <- new_coffee_df[!is.na(new_coffee_df$caffeine), ]

new_coffee_df


#visualizing caffeine
summary_df <- new_coffee_df %>%
  group_by(age, caffeine) %>%
  summarise(count = n(), .groups = 'drop') %>%
  group_by(age) %>%
  mutate(percentage = (count / sum(count)) * 100)

## Create the bar plot
ggplot(summary_df, aes(x = age, y = percentage, fill = caffeine)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Age Group", y = "Cafeine", title = "Caffeine by Age Group") +
  theme_minimal()


#visualizing roast level
summary_df <- new_coffee_df %>%
  group_by(age, roast_level) %>%
  summarise(count = n(), .groups = 'drop') %>%
  group_by(age) %>%
  mutate(percentage = (count / sum(count)) * 100)

## Create the bar plot
ggplot(summary_df, aes(x = age, y = percentage, fill = roast_level)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Age Group", y = "Roast Level", title = "Roast Level by Age Group") +
  theme_minimal()


#visualizing strength
summary_df <- new_coffee_df %>%
  group_by(age, strength) %>%
  summarise(count = n(), .groups = 'drop') %>%
  group_by(age) %>%
  mutate(percentage = (count / sum(count)) * 100)

## Create the bar plot
ggplot(summary_df, aes(x = age, y = percentage, fill = strength)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Age Group", y = "Strength", title = "Strength by Age Group") +
  theme_minimal()
```

